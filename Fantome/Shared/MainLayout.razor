@using Fantome.Store.Modules.Config;
@using Fantome.Dialogs;
@using Fantome.Store.Modules.App;
@using Fantome.Store.Modules.Hashtable;

@inherits Fluxor.Blazor.Web.Components.FluxorComponent

<MudThemeProvider Theme="_theme" />

@code {
	private ActionState GetFetchConfigState() => this.AppState.Value.GetActionState(typeof(FetchConfigAction));
	private ActionState GetFetchHashtableState() => this.AppState.Value.GetActionState(typeof(FetchHashtableAction));
}

@if (GetFetchConfigState().Status != ActionStatus.Finished)
{
	<Spinner Message="Loading Config..."/>
}
else if (GetFetchHashtableState().Status != ActionStatus.Finished)
{
	<Spinner Message="Fetching hashtables..."/>
}
else
{
	if(string.IsNullOrEmpty(this.ConfigState.Value.LeagueLocation))
	{
		 this.DialogService.Show<SelectLeagueLocationDialog>(null, new DialogOptions()
         {
             DisableBackdropClick = true
         });
	}

	<MudLayout>
		<MudAppBar Elevation="0">
			<MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => ToggleNavDrawer())" />
			<MudAppBarSpacer />
			<MudIconButton Icon="@Icons.Custom.Brands.GitHub" Color="Color.Inherit" Link="https://github.com/LoL-Fantome/Fantome" Target="_blank" />
		</MudAppBar>
		<MudDrawer @bind-Open="_isNavDrawerOpen" Elevation="1">
			<MudDrawerHeader>
				<MudText Color="Color.Primary" Typo="Typo.h6">Fantome</MudText>
			</MudDrawerHeader>
			<NavMenu />
		</MudDrawer>
		<MudMainContent>
			@Body
		</MudMainContent>
	</MudLayout>
}
