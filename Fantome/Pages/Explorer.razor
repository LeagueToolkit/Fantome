@page "/explorer"

@using Fantome.Store.Modules.App
@using Fantome.Store.Modules.Explorer;

@inherits Fluxor.Blazor.Web.Components.FluxorComponent

@code {
    private ActionState GetSynchronizeWadRepositoryState() => this.AppState.Value.GetActionState(typeof(SynchronizeWadRepositoryAction));
}

@if (GetSynchronizeWadRepositoryState().Status != ActionStatus.Finished)
{
    <Spinner Message="Synchronizing WAD repository..." />
}
else
{
    <MudPaper Elevation="1">
        <MudToolBar>
            <MudTooltip Text="Open WAD File">
                <MudIconButton Icon="@Icons.Material.Filled.UploadFile" OnClick="() => OpenWadFile()" />
            </MudTooltip>
        </MudToolBar>
    </MudPaper>
    <MudTabs></MudTabs>
    <MudTreeView Items="this.ExplorerState.Value.IndexedItems">
        <ChildContent>
            <MudVirtualize IsEnabled="true" Context="item" Items="this.ExplorerState.Value.IndexedItems">
                <MudTreeViewItem Value="@item" Text="@item.Name" Items="@item.Items" Expanded="true"/>
            </MudVirtualize>
        </ChildContent>
        <ItemTemplate>
            <MudTreeViewItem Value="@context" Text="@context.Name" Items="@context.Items" Expanded="true">
                <ChildContent>
                    <MudVirtualize IsEnabled="true" Context="item" Items="this.ExplorerState.Value.IndexedItems">
                        <MudTreeViewItem Value="@item" Text="@item.Name" Items="@item.Items" Expanded="true"/>
                    </MudVirtualize>
                </ChildContent>
            </MudTreeViewItem>
        </ItemTemplate>
    </MudTreeView>
}

@code {

    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(1);
        await Task.Run(() => this.Dispatcher.Dispatch(new SynchronizeWadRepositoryAction.Request()));
    }
}